# WEB –£–ø–∞–∫–æ–≤—â–∏–∫ —Ä–µ—Å—É—Ä—Å–æ–≤ –¥–ª—è Haxe.

–û–ø–∏—Å–∞–Ω–∏–µ
------------------------------

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–∂–∞—Ç–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ –æ–¥–∏–Ω —Ñ–∞–π–ª –∏ –æ–±—Ä–∞—Ç–Ω–æ–π —Ä–∞—Å–ø–∞–∫–æ–≤–∫–∏ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ —Å–µ—Ä–≤–µ—Ä–∞ –∏–ª–∏ –∫–ª–∏–µ–Ω—Ç–∞.

–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏ –æ—Ç–ª–∏—á–∏—è –æ—Ç –æ–±—ã—á–Ω–æ–≥–æ zip –∞—Ä—Ö–∏–≤–∞:
1. –°–∞–º—ã–π –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º–æ–≥–æ –∫–æ–¥–∞, –±–ª–∏–∂–∞–π—à–∏–π –∞–Ω–∞–ª–æ–≥ –≤–µ—Å–∏—Ç >300–∫–±, –ø—Ä–æ—Ç–∏–≤ 60 WebPackager'–∞. (–°–∂–∞—Ç—ã–π js –±–∏–Ω–∞—Ä–Ω–∏–∫)
2. –°–∞–º–∞—è –≤—ã—Å–æ–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã –∑–∞ —Å—á—ë—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è pako. ([–ü–æ—Ä—Ç](https://github.com/nodeca/pako "High speed zlib port to javascript, works in browser & node.js") —Å C –≤ JS, —Å–¥–µ–ª–∞–Ω–Ω—ã–π –æ–ø—ã—Ç–Ω—ã–º–∏ –ø–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª–∞–º–∏)
3. –ö–∞—Å—Ç–æ–º–Ω—ã–π, –±–∏–Ω–∞—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç. –≠—Ç–æ –Ω–µ –ø–æ–∑–≤–æ–ª–∏—Ç –æ—Ç–∫—Ä—ã—Ç—å –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã–π –ø–æ —Å–µ—Ç–∏ –∞—Ä—Ö–∏–≤ –æ–±—ã—á–Ω—ã–º –∞—Ä—Ö–∏–≤–∞—Ç–æ—Ä–æ–º. (–ú–æ–∂–Ω–æ —Å—á–∏—Ç–∞—Ç—å –∫–∞–∫ –º–∏–Ω—É—Å–æ–º, —Ç–∞–∫ –∏ –ø–ª—é—Å–æ–º)
4. –ù–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–∏–∫–∞–∫–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, –∫—Ä–æ–º–µ pako. (–î–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–∂–∞—Ç–∏—è)
5. –ù–µ –¥–µ–ª–∞–µ—Ç –Ω–∏—á–µ–≥–æ –ª–∏—à–Ω–µ–≥–æ, –¥–∞–∂–µ –Ω–µ —Ä–∞—Å—á–∏—Ç—ã–≤–∞–µ—Ç CRC —Å—É–º–º—É. (–ò–∑–±—ã—Ç–æ—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞, –ª–∏—à–Ω–∏–µ –∑–∞—Ç—Ä–∞—Ç—ã)
6. –†–∞–±–æ—Ç–∞–µ—Ç –≤ –±—Ä–∞—É–∑–µ—Ä–µ –∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.

–§–æ—Ä–º–∞—Ç –∑–∞–ø–∏—Å–∏ –¥–≤–æ–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
------------------------------

–í–∞–ª–∏–¥–Ω—ã–π –∞—Ä—Ö–∏–≤ WebPacker'–∞ –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫:
```
id, version, [header1, file1], [header2, file2], [header3, file3]
```
–ì–¥–µ:
 * id `unsigned Int16` - –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä, –æ–±–æ–∑–Ω–∞—á–∞—é—â–∏–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö WebPackager'a.
 * version `unsigned Int8` - –í–µ—Ä—Å–∏—è –¥–∞–Ω–Ω—ã—Ö. –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è: `0x01`.
 * header - –ó–∞–≥–æ–ª–æ–≤–æ–∫ –æ–ø–∏—Å–∞–Ω–∏—è —Ñ–∞–π–ª–∞, *—Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∏–∂–µ*.
 * file - –î–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª–∞.

–§–æ—Ä–º–∞—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∞:
```
dataLength, nameLength, name
```
–ì–¥–µ:
 * dataLength `unsigned Int32` - –î–ª–∏–Ω–∞ —Ñ–∞–π–ª–∞.
 * nameLength `unsigned Int16` - –î–ª–∏–Ω–∞ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞. (–ù–µ –±–æ–ª–µ–µ 65535 —Å–∏–º–≤–æ–ª–æ–≤ ASCII)
 * name `string ASCII` - –ò–º—è —Ñ–∞–π–ª–∞. –°—Ç—Ä–æ–∫–∞ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∞ —Å –ø–æ–º–æ—â—å—é: `encodeURIComponent()`.

–ü–æ—Ä—è–¥–æ–∫ –±–∞–π—Ç–æ–≤: `big-endian`.

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
------------------------------

```
package;

import pkg.Packer;
import pkg.Unpacker;
import pkg.Utils;
import js.Browser;
import js.html.Blob;
import js.html.URL;

class Main {
    static public function main() {
        var str1 = "Hell √∂ ‚Ç¨ Œ© ùÑû, –∫–∞–∫–æ–π —Å–µ–≥–æ–¥–Ω—è `—á—É–¥–µ—Å–Ω—ã–π` –¥–µ–Ω—å, –Ω–µ —Ç–∞–∫ –ª–∏, Doppelg√§nger?";
        var str2 = "Hi!";
        var str3 = "No compress please";
        
        // –£–ø–∞–∫–æ–≤–∫–∞:
        var packer = new Packer();
        packer.add(Utils.strToBytes(str1), "Hell √∂ ‚Ç¨ Œ© ùÑû__Doppelg√§nger.josy", { level:5 });
        packer.add(Utils.strToBytes(str2), "–ü—Ä–æ—Å—Ç–æ —Ñ–∞–π–ª.txt", { level:5 });
        packer.add(Utils.strToBytes(str3), "–§–∞–π–ª –±–µ–∑ –∫–æ–º–ø—Ä–µ—Å—Å–∏–∏.txt", { level:0 });

        // –†–∞—Å–ø–∞–∫–æ–≤–∫–∞:
        var unpacker = new Unpacker(packer.data);
        trace(Utils.bytesToStr(unpacker.get().data));
        trace(unpacker.get());
        trace(Utils.bytesToStr(unpacker.get().data));
        trace(unpacker.get());

        // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Å—Ç—Ä–æ–∫:
        trace(Utils.bytesToStr(Utils.strToBytes(str1)), str1 == Utils.bytesToStr(Utils.strToBytes(str1)));

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–∂–∞—Ç—ã–π —Ñ–∞–π–ª —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä:
        saveFile(packer.data, "File.data");
    }

    static public function saveFile(data:Any, name:String = "File", type:String = null):Void {
        var file = new Blob([data], {type: type});

        // IE10+
        if (untyped Browser.window.navigator.msSaveOrOpenBlob) {
            untyped Browser.window.navigator.msSaveOrOpenBlob(file, filename);
            return;
        }
        
        // –î—Ä—É–≥–∏–µ:
        var url = URL.createObjectURL(file);
        var a = Browser.document.createAnchorElement();
        a.href = url;
        a.download = name;
        Browser.document.body.appendChild(a);
        a.click();
        
        Browser.window.setTimeout(function(){
            Browser.document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }, 0);
    }
}
```

–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤ Haxe
------------------------------

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ haxelib, —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ Haxe.
2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –∫–æ–º–∞–Ω–¥—É, —á—Ç–æ–±—ã —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É WebPackager –≥–ª–æ–±–∞–ª—å–Ω–æ —Å–µ–±–µ –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—É—é –º–∞—à–∏–Ω—É:
```
haxelib git webpackager https://github.com/VolkovRA/WebPackager.git master
```
–°–∏–Ω—Ç–∞–∫—Å–∏—Å –∫–æ–º–∞–Ω–¥—ã:
```
haxelib git [project-name] [git-clone-path] [branch]
haxelib git minject https://github.com/massiveinteractive/minject.git         # Use HTTP git path.
haxelib git minject git@github.com:massiveinteractive/minject.git             # Use SSH git path.
haxelib git minject git@github.com:massiveinteractive/minject.git v2          # Checkout branch or tag `v2`.
```
3. –î–æ–±–∞–≤—å—Ç–µ –≤ —Å–≤–æ–π –ø—Ä–æ–µ–∫—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫—É WebPackager, —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ—ë –≤ –∫–æ–¥–µ. –ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ HaxeDevelop, —Ç–æ –ø—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤—å—Ç–µ –≤ —Ñ–∞–π–ª .hxproj –∑–∞–ø–∏—Å—å:
```
<haxelib>
	<library name="webpackager" />
</haxelib>
```
4. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –±–∏–±–ª–∏–æ—Ç–µ–∫—É –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è pako –≤ Haxe:
[https://github.com/VolkovRA/HaxePako](https://github.com/VolkovRA/HaxePako "The Haxe high quality extern definitions for pako") 

–°–º–æ—Ç—Ä–∏—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é:
 * [GitHub HaxePako](https://github.com/VolkovRA/HaxePako "The Haxe high quality extern definitions for pako")
 * [GitHub Pako](https://github.com/nodeca/pako "High speed zlib port to javascript, works in browser & node.js")
 * [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Haxelib](https://lib.haxe.org/documentation/using-haxelib/ "Using Haxelib")